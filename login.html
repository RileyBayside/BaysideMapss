<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bayside â€” Sign in</title>
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="login.css">
  <script src="auth.js"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>
  <script src="auth-bridge.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <img class="logo" src="logo.png" alt="Bayside Slashing logo">
      <span class="badge">Secure Sign-in</span>
      <h1>Welcome</h1>
      <p class="sub">Sign in with your username and password</p>

      <form id="userForm">
        <label for="username">Username</label>
        <input id="username" name="username" type="text" placeholder="e.g. alex" required />

        <label for="password">Password</label>
        <input id="password" name="password" type="password" placeholder="Your password" required />

        <button class="btn" type="submit">Sign in</button>
        <div id="userErr" class="err"></div>
      </form>

      <div class="note">
        Your username signs in as <code>username@bayside.local</code>.<br/>
        Having trouble? Contact your admin.
      </div>
    </div>
  </div>

  <script>
    const qs = (s) => document.querySelector(s);
    const auth = firebase.auth();

    // Username + password (username maps to username@bayside.local)
    qs('#userForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      qs('#userErr').textContent = '';
      const username = (qs('#username').value || '').trim();
      const password = (qs('#password').value || '').trim();
      const email = username + '@bayside.local';
      try {
        const cred = await auth.signInWithEmailAndPassword(email, password);
        await window.BaysideAuthBridge.onFirebaseLogin(cred.user);
      } catch (err) {
        qs('#userErr').textContent = err.message || 'Sign-in failed.';
      }
    });
  </script>
</body>
</html>
