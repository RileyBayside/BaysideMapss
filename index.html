<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bayside — Dashboard</title>

  <!-- Type -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0f172a;
      --ink-2:#111827;
      --muted:#e5e7eb;
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#d11e2b;
      --accent-600:#b71a24;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    /* Header (roomy for bigger logo) */
    .header{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; padding:16px 22px; background:#fff; border-bottom:1px solid var(--muted);
      position:sticky; top:0; z-index:10;
    }
    .brand{ display:flex; align-items:center; gap:14px; min-width:0; }
    .brand img{ height:56px; display:block }
    .brand .title{
      font-size:22px; font-weight:800; color:var(--ink-2); letter-spacing:.2px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .userbox{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .email{
      font-weight:600; color:#334155; background:#f1f5f9; border:1px solid #e2e8f0;
      padding:8px 10px; border-radius:10px; max-width:52vw; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .btn{
      border:0; border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer; color:#fff;
      background:var(--ink);
    }
    .btn:hover{ background:#1f2937 }

    /* Layout */
    .container{ max-width:1120px; margin: 24px auto; padding: 0 16px }
    .section-title{ font-size:18px; font-weight:800; margin: 10px 2px 12px; color:var(--ink-2) }

    .card{
      background:var(--card); border:1px solid var(--muted); border-radius:16px;
      box-shadow:0 8px 26px rgba(16,24,40,.08);
    }

    /* Work areas */
    .links{ display:grid; grid-template-columns: repeat(3, 1fr); gap:16px }
    .link-card{ overflow:hidden; display:flex; flex-direction:column }
    .link-card img{
      width:100%;
      height:220px; object-fit:cover; object-position:center; display:block; background:#e2e8f0;
    }
    .link-body{ padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px }
    .link-title{ font-weight:800; font-size:16px; color:var(--ink-2) }
    .link-go{
      text-decoration:none; color:#fff; background:var(--ink); padding:9px 12px; border-radius:10px; font-weight:800;
    }
    .link-go:hover{ background:#1f2937 }

    /* Tasks */
    .tasks{ margin-top:24px }
    .task-card{ padding:16px }
    .task-empty{
      padding:14px; border:1px dashed #cbd5e1; border-radius:12px; background:#f8fafc; color:#475569; font-weight:600;
    }
    .task-list{ list-style:none; margin:0; padding:0; display:grid; gap:10px }
    .task{
      display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:12px;
      border:1px solid #e2e8f0; background:#fff; font-weight:700; color:#0f172a;
    }
    .task .pill{
      background:#fee2e2; color:#7f1d1d; border:1px solid #fecaca; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:800;
    }

    /* Responsive */
    @media (max-width:980px){
      .links{ grid-template-columns: 1fr 1fr }
    }
    @media (max-width:640px){
      .links{ grid-template-columns: 1fr }
      .brand .title{ display:none }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="brand">
      <img src="logo.png" alt="Bayside logo" onerror="this.style.display='none'">
      <div class="title">Dashboard</div>
    </div>
    <div class="userbox">
      <div id="userEmail" class="email">—</div>
      <button id="logoutBtn" class="btn" type="button">Logout</button>
    </div>
  </header>

  <main class="container">
    <!-- Work areas (top of page) -->
    <h2 class="section-title">Work areas</h2>
    <section class="links">
      <article class="card link-card">
        <img src="MOWING PICTURE.png" alt="Parks Mowing" onerror="this.style.display='none'">
        <div class="link-body">
          <div class="link-title">Parks Mowing</div>
          <a class="link-go" href="ParksMowing.html">Open</a>
        </div>
      </article>

      <article class="card link-card">
        <img src="SNIPPING PICTURE.png" alt="Parks Snipping" onerror="this.style.display='none'">
        <div class="link-body">
          <div class="link-title">Parks Snipping</div>
          <a class="link-go" href="ParksSnipping.html">Open</a>
        </div>
      </article>

      <article class="card link-card">
        <img src="FIREBREAKS PICTURE.png" alt="Firebreaks" onerror="this.style.display='none'">
        <div class="link-body">
          <div class="link-title">Firebreaks</div>
          <a class="link-go" href="Firebreaks.html">Open</a>
        </div>
      </article>
    </section>

    <!-- Tasks to complete -->
    <section class="tasks">
      <h2 class="section-title">Tasks to complete</h2>
      <div class="card task-card">
        <ul id="taskList" class="task-list" aria-live="polite">
          <!-- Filled by Firestore; fallback placeholder added if none -->
        </ul>
        <div id="taskEmpty" class="task-empty" style="display:none">
          No tasks found. Example: <b>Zone 1 — Numbers 1–50</b>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>

  <script>
    (function(){
      const emailEl = document.getElementById('userEmail');
      const logoutBtn = document.getElementById('logoutBtn');
      const taskList = document.getElementById('taskList');
      const taskEmpty = document.getElementById('taskEmpty');

      function renderTask(t){
        // Expect fields: zone (e.g. "Zone 1"), range (e.g. "Numbers 1–50"), status
        const li = document.createElement('li');
        li.className = 'task';
        const pill = document.createElement('span');
        pill.className = 'pill';
        pill.textContent = (t.zone || 'Zone ?');
        const text = document.createElement('span');
        text.textContent = '— ' + (t.range || 'Numbers ?');
        li.appendChild(pill);
        li.appendChild(text);
        return li;
      }

      function showEmpty(show){
        taskEmpty.style.display = show ? 'block' : 'none';
      }

      firebase.auth().onAuthStateChanged(async user=>{
        if(!user){
          window.location.href = 'login.html';
          return;
        }
        emailEl.textContent = user.email || 'Signed in';

        // Load tasks from Firestore
        try{
          const db = firebase.firestore();
          // assignments where userId == uid and status != 'done'
          const snap = await db.collection('assignments')
            .where('userId', '==', user.uid)
            .where('status', 'in', ['open', 'assigned', 'in_progress'])
            .orderBy('zone', 'asc')
            .get();

          taskList.innerHTML = '';
          if(snap.empty){
            // Show friendly placeholder
            showEmpty(true);
          }else{
            showEmpty(false);
            snap.forEach(doc=>{
              const data = doc.data() || {};
              taskList.appendChild(renderTask({
                zone: data.zone || '',
                range: data.range || data.parksRange || ''
              }));
            });
          }
        }catch(err){
          console.warn('Task load error:', err);
          // Fall back to example
          taskList.innerHTML = '';
          showEmpty(true);
        }
      });

      logoutBtn.addEventListener('click', async ()=>{
        try{
          await firebase.auth().signOut();
          window.location.href = 'login.html';
        }catch(e){
          console.warn(e);
          alert('Logout failed. Please try again.');
        }
      });
    })();
  </script>
</body>
</html>
