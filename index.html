<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Leaflet Satellite Map - Search by MowingID</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/2.9.9/leaflet-search.min.css" />
  <style>
    body, html, #map { height: 100%; margin:0; padding:0; }
    #map { height: 100vh; }
    .legend { background: white; padding: 6px; border-radius: 4px; box-shadow: 0 0 6px rgba(0,0,0,0.3); }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/2.9.9/leaflet-search.src.min.js"></script>

<script>
  const map = L.map('map').setView([0,0], 2);

  // Satellite basemap (Esri World Imagery)
  const sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19,
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community'
  }).addTo(map);

  // Style function based on CutsPerYear property
  function styleFeature(feature) {
    const cuts = feature.properties['CutsPerYear'];
    let color = '#2b7bba'; // default blueish
    if (cuts == 15) color = 'green';
    if (cuts == 18) color = 'blue';
    return {
      color: color,
      weight: 2,
      opacity: 0.9,
      fillOpacity: 0.3
    };
  }

  let geojsonLayer;
  fetch('data.geojson')
    .then(r => r.json())
    .then(data => {
      geojsonLayer = L.geoJSON(data, {
        style: styleFeature,
        onEachFeature: function(feature, layer) {
          let props = feature.properties || {};
          let html = '<div><strong>' + (props['MowingID'] || props.name || '') + '</strong><br/>';
          for (let k in props) {
            html += '<b>' + k + ':</b> ' + props[k] + '<br/>';
          }
          html += '</div>';
          layer.bindPopup(html);
        }
      }).addTo(map);

      if (geojsonLayer.getBounds && geojsonLayer.getBounds().isValid()) {
        map.fitBounds(geojsonLayer.getBounds());
      }

      // Search control configured for MowingID
      const searchControl = new L.Control.Search({
        layer: geojsonLayer,
        propertyName: 'MowingID',
        initial: false,
        zoom: 17,
        marker: false,
        textPlaceholder: 'Search MowingID (e.g. M0123)'
      });
      map.addControl(searchControl);
    })
    .catch(err => {
      console.error('Error loading GeoJSON:', err);
      alert('Failed to load data.geojson. Make sure the file exists in the same folder.');
    });
</script>
</body>
</html>
